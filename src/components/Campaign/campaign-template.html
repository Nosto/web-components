<!-- 
  Campaign liquid template for multiple rendering scenarios
  Supports simple, native, and section modes with grid and carousel layouts
-->
<template id="campaign-template">
  <div class="nosto-campaign-wrapper">
    <!-- Campaign heading (if provided) -->
    <h2 v-if="settings.title" class="campaign-title">{{ settings.title }}</h2>
    
    <!-- Simple mode: uses SimpleCard with optional VariantSelector -->
    <div v-if="settings.mode === 'simple'" class="campaign-simple">
      <!-- Grid layout for simple mode -->
      <div 
        v-if="settings.layout === 'grid'" 
        class="campaign-grid"
        :class="'campaign-grid-' + (products ? products.length : 0)"
      >
        <div v-for="product in products" :key="product.product_id || product.id" class="campaign-grid-item">
          <nosto-simple-card
            :handle="product.handle"
            :alternate="settings.alternate"
            :brand="settings.brand"
            :discount="settings.discount"
            :rating="settings.rating"
            :sizes="settings.sizes"
          >
            <nosto-variant-selector
              v-if="product.handle && settings.preselect !== false"
              :handle="product.handle"
              :preselect="settings.preselect"
            ></nosto-variant-selector>
          </nosto-simple-card>
        </div>
      </div>
      
      <!-- Carousel layout for simple mode -->
      <div v-if="settings.layout === 'carousel'" class="campaign-carousel">
        <div class="swiper">
          <div class="swiper-wrapper">
            <div v-for="product in products" :key="product.product_id || product.id" class="swiper-slide">
              <nosto-simple-card
                :handle="product.handle"
                :alternate="settings.alternate"
                :brand="settings.brand"
                :discount="settings.discount"
                :rating="settings.rating"
                :sizes="settings.sizes"
              >
                <nosto-variant-selector
                  v-if="product.handle && settings.preselect !== false"
                  :handle="product.handle"
                  :preselect="settings.preselect"
                ></nosto-variant-selector>
              </nosto-simple-card>
            </div>
          </div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
        </div>
      </div>
    </div>
    
    <!-- Native mode: uses DynamicCard -->
    <div v-if="settings.mode === 'native'" class="campaign-native">
      <!-- Grid layout for native mode -->
      <div 
        v-if="settings.layout === 'grid'" 
        class="campaign-grid"
        :class="'campaign-grid-' + (products ? products.length : 0)"
      >
        <div v-for="product in products" :key="product.product_id || product.id" class="campaign-grid-item">
          <nosto-dynamic-card
            :handle="product.handle"
            :template="settings.template"
            :section="settings.section"
            :variant-id="product.variant_id"
            :placeholder="true"
            :lazy="settings.lazy"
          ></nosto-dynamic-card>
        </div>
      </div>
      
      <!-- Carousel layout for native mode -->
      <div v-if="settings.layout === 'carousel'" class="campaign-carousel">
        <div class="swiper">
          <div class="swiper-wrapper">
            <div v-for="product in products" :key="product.product_id || product.id" class="swiper-slide">
              <nosto-dynamic-card
                :handle="product.handle"
                :template="settings.template"
                :section="settings.section"
                :variant-id="product.variant_id"
                :placeholder="true"
                :lazy="settings.lazy"
              ></nosto-dynamic-card>
            </div>
          </div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
        </div>
      </div>
    </div>
    
    <!-- Section mode: uses SectionCampaign without children -->
    <div v-if="settings.mode === 'section'" class="campaign-section">
      <nosto-section-campaign
        :placement="settings.placement"
        :section="settings.section"
      ></nosto-section-campaign>
    </div>
  </div>
  
  <!-- Initialize Swiper carousel if layout is carousel -->
  <script v-if="settings.layout === 'carousel'">
    // Initialize Swiper when the template is rendered
    (function() {
      const swiperElement = document.querySelector('.campaign-carousel .swiper');
      if (swiperElement && window.Swiper) {
        new window.Swiper(swiperElement, {
          slidesPerView: 'auto',
          spaceBetween: 16,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
          breakpoints: {
            640: {
              slidesPerView: 2,
            },
            768: {
              slidesPerView: 3,
            },
            1024: {
              slidesPerView: 4,
            },
          }
        });
      }
    })();
  </script>
</template>

<style>
  .nosto-campaign-wrapper {
    width: 100%;
  }
  
  .campaign-title {
    margin: 0 0 1rem 0;
    font-size: 1.5rem;
    font-weight: 600;
  }
  
  .campaign-grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }
  
  .campaign-grid-1 {
    grid-template-columns: 1fr;
  }
  
  .campaign-grid-2 {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .campaign-grid-3 {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }
  
  .campaign-grid-4,
  .campaign-grid-5,
  .campaign-grid-6 {
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  }
  
  @media (max-width: 768px) {
    .campaign-grid {
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.5rem;
    }
  }
  
  .campaign-carousel {
    position: relative;
  }
  
  .campaign-carousel .swiper {
    padding-bottom: 2rem;
  }
  
  .campaign-carousel .swiper-slide {
    width: auto;
    min-width: 250px;
  }
  
  .campaign-carousel .swiper-pagination {
    bottom: 0;
  }
  
  .campaign-section {
    width: 100%;
  }
</style>