query ProductsByHandles(
  $country: CountryCode!
  $language: LanguageCode!
  $query: String!
  $first: Int!
)
@inContext(country: $country, language: $language) {
  products(first: $first, query: $query) {
    nodes {
      id
      handle
      title
      vendor
      description
      encodedVariantExistence
      onlineStoreUrl
      availableForSale
      images(first: 10) {
        nodes {
          url
          altText
          height
          width
          thumbhash
        }
      }
      featuredImage {
        url
        altText
        height
        width
        thumbhash
      }
      adjacentVariants {
        ...VariantFragment
      }
      options(first: 50) {
        name
        optionValues {
          firstSelectableVariant {
            ...VariantFragment
          }
          name
          swatch {
            color
            image {
              alt
              id
              mediaContentType
              previewImage {
                url
              }
            }
          }
        }
      }
    }
  }
}

fragment VariantFragment on ProductVariant {
  availableForSale
  title
  id
  image {
    url
    altText
    height
    width
    thumbhash
  }
  price {
    currencyCode
    amount
  }
  compareAtPrice {
    currencyCode
    amount
  }
  product {
    id
    onlineStoreUrl
  }
  selectedOptions {
    name
    value
  }
}
